generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  isAnonymous   Boolean?  @default(false)
  level         Int       @default(1)
  xp            Int       @default(0)

  sessions      Session[]
  accounts      Account[]

  conquistas    ConquistaUsuario[] @relation("usuario_conquistas")
  historicos    Historico[]        @relation("usuario_historicos")
  jogosCriados  Jogo[]             @relation("usuario_jogosCriados")

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id @default(auto()) @map("_id") @db.ObjectId
  accountId             String
  providerId            String
  userId                String    @db.ObjectId
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

model Verification {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model Conquista {
  id        String               @id @default(auto()) @map("_id") @db.ObjectId
  nome      String               @unique
  descricao String?
  pontosXp  Int?
  icone     String?

  usuarios  ConquistaUsuario[]   @relation(fields: [], references: [])
}

model ConquistaUsuario {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  usuarioId    String    @db.ObjectId
  conquistaId  String    @db.ObjectId
  dataObtencao DateTime? @default(now())

  usuario      User       @relation("usuario_conquistas", fields: [usuarioId], references: [id], onDelete: Cascade)
  conquista    Conquista  @relation(fields: [conquistaId], references: [id], onDelete: Cascade)
}

model Historico {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  usuarioId String   @db.ObjectId
  jogoId    String   @db.ObjectId
  status    String?
  progresso Int?

  usuario   User  @relation("usuario_historicos", fields: [usuarioId], references: [id])
  jogo      Jogo  @relation("jogo_historicos", fields: [jogoId], references: [id])
}

model Jogo {
  id           String               @id @default(auto()) @map("_id") @db.ObjectId
  idCriador    String               @db.ObjectId
  nome         String?
  tema         String?
  visibilidade String?
  senha        String?
  dataCriacao  DateTime?            @default(now())
  ativo        Boolean?             @default(true)
  capaUrl      String?     

  criador      User                 @relation("usuario_jogosCriados", fields: [idCriador], references: [id])
  historicos   Historico[]          @relation("jogo_historicos")
  config       Config?              @relation("jogo_config")
}

model Config {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  jogoId   String   @db.ObjectId @unique
  tipo     String?

  jogo     Jogo     @relation("jogo_config", fields: [jogoId], references: [id])

  verbo    ConfigJogoVerbo?
  caca     ConfigJogoCaca?
  cruzada  ConfigJogoCruzadas?
}

model ConfigJogoVerbo {
  id             String  @id @default(auto()) @map("_id") @db.ObjectId
  configId       String  @db.ObjectId @unique
  palavraSecreta String?
  maxTentativas  Int?
  dica           String?

  config         Config  @relation(fields: [configId], references: [id])
}


model ConfigJogoCaca {
  id       String           @id @default(auto()) @map("_id") @db.ObjectId
  configId String           @db.ObjectId @unique
  altura   Int?
  largura  Int?
  tema     String?

  config   Config           @relation(fields: [configId], references: [id])
  palavras PalavraCaca[]    @relation("caca_palavras")
}


model ConfigJogoCruzadas {
  id       String               @id @default(auto()) @map("_id") @db.ObjectId
  configId String               @db.ObjectId @unique
  altura   Int?
  largura  Int?
  tema     String?

  config   Config               @relation(fields: [configId], references: [id])
  palavras PalavraCruzadas[]    @relation("cruzadas_palavras")
}


model PalavraCaca {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  configCacaId  String  @db.ObjectId
  palavra       String?
  direcao       String?
  posicaoInicial Json?
  posicaoFinal   Json?
  dica          String?

  config        ConfigJogoCaca @relation("caca_palavras", fields: [configCacaId], references: [id])
}

model PalavraCruzadas {
  id               String  @id @default(auto()) @map("_id") @db.ObjectId
  configCruzadasId String  @db.ObjectId
  palavra          String?
  direcao          String?
  posicaoInicial   Json?
  posicaoFinal     Json?
  dica             String?

  config           ConfigJogoCruzadas @relation("cruzadas_palavras", fields: [configCruzadasId], references: [id])
}
